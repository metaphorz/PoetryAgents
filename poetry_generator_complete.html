<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poetry Agents - AI Poetry Dialogue Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .form-container {
            padding: 30px;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e8f4f8;
            border-radius: 15px;
            background: #f8fcff;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .poets-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 20px;
        }

        .poet-selection {
            background: white;
            padding: 18px;
            border-radius: 12px;
            border: 2px solid #e1f5fe;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .poet-selection h3 {
            color: #1976d2;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #34495e;
            font-size: 14px;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        select:disabled {
            opacity: 0.5;
            background: #f0f0f0;
            cursor: not-allowed;
        }

        .radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: 2px solid #e8f4f8;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .radio-item:hover {
            background: #e8f4f8;
            border-color: #3498db;
        }

        .radio-item input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .api-mode {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }

        .generate-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .generate-btn:hover {
            background: linear-gradient(135deg, #229954 0%, #27ae60 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(39, 174, 96, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        #loadingMessage {
            display: none;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 8px;
            color: #2c3e50;
        }

        .result-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .error-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8d7da;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .download-btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            text-decoration: none;
            display: inline-block;
        }

        .download-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ Poetry Agents</h1>
            <p>AI Poetry Dialogue Generator</p>
        </div>

        <div class="form-container">
            <form id="poetryForm">
                <div class="section">
                    <h2>üîå API Configuration</h2>
                    <div class="api-mode">
                        <label><input type="radio" name="apiMode" value="direct" checked> Direct APIs (Claude, OpenAI, Gemini)</label>
                        <label><input type="radio" name="apiMode" value="openrouter"> OpenRouter (100+ Models)</label>
                    </div>
                </div>

                <div class="section" id="directApiSection">
                    <h2>üé≠ Poet Configuration</h2>
                    <div class="poets-container">
                        <div class="poet-selection">
                            <h3>üé≠ Poet 1</h3>
                            <div class="form-group">
                                <label for="poet1Provider">LLM Provider:</label>
                                <select id="poet1Provider" name="poet1Provider" required>
                                    <option value="">Select Provider...</option>
                                    <option value="Claude">Claude (Anthropic)</option>
                                    <option value="OpenAI">OpenAI</option>
                                    <option value="Gemini">Gemini (Google)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="poet1Model">Specific Model:</label>
                                <select id="poet1Model" name="poet1Model" disabled required>
                                    <option value="">First select a provider...</option>
                                </select>
                            </div>
                        </div>

                        <div class="poet-selection">
                            <h3>üé≠ Poet 2</h3>
                            <div class="form-group">
                                <label for="poet2Provider">LLM Provider:</label>
                                <select id="poet2Provider" name="poet2Provider" required>
                                    <option value="">Select Provider...</option>
                                    <option value="Claude">Claude (Anthropic)</option>
                                    <option value="OpenAI">OpenAI</option>
                                    <option value="Gemini">Gemini (Google)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="poet2Model">Specific Model:</label>
                                <select id="poet2Model" name="poet2Model" disabled required>
                                    <option value="">First select a provider...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üìù Poetry Configuration</h2>
                    <div class="form-group">
                        <label for="theme">Theme:</label>
                        <input type="text" id="theme" name="theme" placeholder="e.g., a walk in the snow" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Poetry Form:</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="form_haiku" name="form" value="haiku" checked>
                                <label for="form_haiku">Haiku</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="form_prose" name="form" value="prose">
                                <label for="form_prose">Prose</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="form_sonnet" name="form" value="sonnet">
                                <label for="form_sonnet">Sonnet</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="form_limerick" name="form" value="limerick">
                                <label for="form_limerick">Limerick</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="form_villanelle" name="form" value="villanelle">
                                <label for="form_villanelle">Villanelle</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="form_ballad" name="form" value="ballad">
                                <label for="form_ballad">Ballad</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="form_ghazal" name="form" value="ghazal">
                                <label for="form_ghazal">Ghazal</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="form_tanka" name="form" value="tanka">
                                <label for="form_tanka">Tanka</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="conversationLength">Conversation Rounds:</label>
                        <input type="number" id="conversationLength" name="conversationLength" min="1" max="10" value="3" required>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="useEmojis" name="useEmojis" checked>
                            Enhance with emojis
                        </label>
                    </div>
                </div>

                <button type="submit" class="generate-btn" id="generateBtn">
                    üé® Generate Poetry Dialogue
                </button>
            </form>
            
            <div id="loadingMessage">
                <p>üé≠ Generating poetry dialogue... This may take a moment.</p>
            </div>

            <div id="resultSection" class="result-section">
                <h3>‚úÖ Poetry Generated Successfully!</h3>
                <p id="resultMessage"></p>
                <div id="downloadLinks"></div>
            </div>

            <div id="errorSection" class="error-section">
                <h3>‚ùå Error Generating Poetry</h3>
                <p id="errorMessage"></p>
            </div>
        </div>
    </div>

    <script>
        // Dynamic model data - fetched from API
        let modelData = {};

        function debugLog(message) {
            console.log(`[Poetry Agents] ${message}`);
        }

        async function fetchModelsFromAPI(provider) {
            debugLog(`Fetching models from API for provider: ${provider}`);
            
            try {
                const response = await fetch(`http://localhost:8080/api/models/${provider.toLowerCase()}`);
                
                if (response.ok) {
                    const models = await response.json();
                    debugLog(`Successfully fetched ${Object.keys(models).length} models for ${provider}`);
                    return models;
                } else {
                    debugLog(`Failed to fetch models for ${provider}: ${response.status}`);
                    return null;
                }
            } catch (error) {
                debugLog(`Error fetching models for ${provider}: ${error.message}`);
                return null;
            }
        }

        async function loadModelsForPoet(poetNumber, provider) {
            debugLog(`Loading models for Poet ${poetNumber}, Provider: "${provider}"`);
            
            const modelSelect = document.getElementById(`poet${poetNumber}Model`);
            
            if (!modelSelect) {
                debugLog(`ERROR: Model select element not found: poet${poetNumber}Model`);
                return;
            }
            
            if (!provider) {
                debugLog(`No provider selected - disabling dropdown`);
                modelSelect.disabled = true;
                modelSelect.innerHTML = '<option value="">First select a provider...</option>';
                return;
            }

            // Show loading state
            modelSelect.disabled = true;
            modelSelect.innerHTML = '<option value="">Loading models...</option>';
            
            // Check if we already have models for this provider
            if (!modelData[provider]) {
                debugLog(`Fetching models for ${provider} from API...`);
                const models = await fetchModelsFromAPI(provider);
                
                if (models) {
                    modelData[provider] = models;
                } else {
                    debugLog(`ERROR: Failed to fetch models for provider: ${provider}`);
                    modelSelect.innerHTML = '<option value="">Error loading models</option>';
                    modelSelect.disabled = true;
                    return;
                }
            }
            
            const models = modelData[provider];
            debugLog(`Found ${Object.keys(models).length} models for ${provider}`);
            
            // Clear and populate dropdown
            modelSelect.innerHTML = '<option value="">Select model...</option>';
            
            Object.entries(models).forEach(([displayName, modelId]) => {
                const option = document.createElement('option');
                option.value = modelId;
                option.textContent = displayName;
                modelSelect.appendChild(option);
            });
            
            // Enable the dropdown
            modelSelect.disabled = false;
            debugLog(`SUCCESS: Enabled dropdown with ${Object.keys(models).length} models`);
        }

        function toggleApiMode() {
            const apiMode = document.querySelector('input[name="apiMode"]:checked').value;
            debugLog(`Toggling API mode to: ${apiMode}`);
            
            const directSection = document.getElementById('directApiSection');
            
            if (apiMode === 'direct') {
                directSection.style.display = 'block';
                debugLog(`Showing Direct API mode`);
            } else {
                directSection.style.display = 'none';
                debugLog(`OpenRouter mode not implemented in this version`);
                alert('OpenRouter mode coming soon! Please use Direct APIs for now.');
                document.querySelector('input[name="apiMode"][value="direct"]').checked = true;
            }
        }

        function showLoading() {
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').textContent = 'üîÑ Generating...';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').textContent = 'üé® Generate Poetry Dialogue';
        }

        function showResult(data) {
            debugLog('Showing result:', data);
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultMessage').textContent = data.message || 'Poetry dialogue generated successfully!';
            
            const downloadLinks = document.getElementById('downloadLinks');
            downloadLinks.innerHTML = '';
            
            if (data.filename) {
                const downloadBtn = document.createElement('a');
                downloadBtn.href = `http://localhost:8080/download/${data.filename}`;
                downloadBtn.className = 'download-btn';
                downloadBtn.textContent = `üì• Download ${data.filename}`;
                downloadBtn.target = '_blank';
                downloadLinks.appendChild(downloadBtn);
            }
        }

        function showError(message) {
            debugLog('Showing error:', message);
            document.getElementById('errorSection').style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
        }

        async function generatePoetry(formData) {
            debugLog('Generating poetry with data:', formData);
            
            try {
                const response = await fetch('http://localhost:8080/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResult(data);
                } else {
                    showError(data.error || 'Unknown error occurred');
                }
            } catch (error) {
                debugLog('Network error:', error);
                showError('Network error: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Set up event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog(`Page loaded - setting up event listeners...`);
            
            // API mode change handlers
            const apiModeRadios = document.querySelectorAll('input[name="apiMode"]');
            apiModeRadios.forEach(radio => {
                radio.addEventListener('change', toggleApiMode);
            });
            
            // Provider change handlers
            const poet1Provider = document.getElementById('poet1Provider');
            const poet2Provider = document.getElementById('poet2Provider');
            
            if (poet1Provider) {
                poet1Provider.addEventListener('change', function() {
                    debugLog(`Poet 1 provider changed to: "${this.value}"`);
                    loadModelsForPoet(1, this.value);
                });
                debugLog(`Poet 1 provider event listener set up`);
            } else {
                debugLog(`ERROR: Poet 1 provider element not found`);
            }

            if (poet2Provider) {
                poet2Provider.addEventListener('change', function() {
                    debugLog(`Poet 2 provider changed to: "${this.value}"`);
                    loadModelsForPoet(2, this.value);
                });
                debugLog(`Poet 2 provider event listener set up`);
            } else {
                debugLog(`ERROR: Poet 2 provider element not found`);
            }
            
            // Form submission handler
            const form = document.getElementById('poetryForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                debugLog('Form submitted - generating poetry');
                
                // Collect form data
                const formData = new FormData(form);
                const data = {
                    poet1Provider: formData.get('poet1Provider'),
                    poet1Model: formData.get('poet1Model'),
                    poet2Provider: formData.get('poet2Provider'),
                    poet2Model: formData.get('poet2Model'),
                    theme: formData.get('theme'),
                    form: formData.get('form'),
                    conversationLength: parseInt(formData.get('conversationLength')),
                    useEmojis: formData.has('useEmojis')
                };
                
                debugLog('Form data collected:', data);
                
                // Validate required fields
                if (!data.poet1Provider || !data.poet1Model || !data.poet2Provider || !data.poet2Model || !data.theme) {
                    showError('Please fill in all required fields');
                    return;
                }
                
                showLoading();
                generatePoetry(data);
            });
            
            debugLog(`All event listeners set up successfully`);
            debugLog(`Ready to generate poetry!`);
        });
    </script>
</body>
</html>