<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Model Dropdown Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #ddd; border-radius: 8px; }
        select { width: 300px; padding: 8px; margin: 5px 0; font-size: 14px; }
        select:disabled { opacity: 0.5; background: #f0f0f0; }
        .result { margin: 10px 0; padding: 8px; border-radius: 4px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; }
        .debug-info { background: #e7f3ff; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîç Model Dropdown Debug Test</h1>
    <p>This test isolates the model dropdown functionality to identify the exact issue.</p>

    <div class="test-section">
        <h3>Test 1: Basic Model Loading</h3>
        <label>Provider:</label><br>
        <select id="testProvider1">
            <option value="">Select Provider...</option>
            <option value="Claude">Claude</option>
            <option value="OpenAI">OpenAI</option>
            <option value="Gemini">Gemini</option>
        </select><br>
        
        <label>Model (should populate when provider selected):</label><br>
        <select id="testModel1" disabled>
            <option value="">First select a provider...</option>
        </select>
        
        <div id="testResult1" class="result"></div>
        <div id="debugInfo1" class="debug-info"></div>
        
        <button onclick="manualTest('Claude', 'testModel1', 'testResult1', 'debugInfo1')">Manual Test: Claude</button>
        <button onclick="manualTest('OpenAI', 'testModel1', 'testResult1', 'debugInfo1')">Manual Test: OpenAI</button>
    </div>

    <div class="test-section">
        <h3>Test 2: Data Inspection</h3>
        <button onclick="inspectModelData()">Inspect Model Data</button>
        <button onclick="testFunctionExists()">Test Function Exists</button>
        <div id="inspectionResult" class="debug-info"></div>
    </div>

    <div class="test-section">
        <h3>Test 3: Console Logs</h3>
        <p>Open browser console (F12 ‚Üí Console) to see detailed debugging info.</p>
        <button onclick="enableVerboseLogging()">Enable Verbose Logging</button>
    </div>

    <script>
        // Model data extracted from main HTML file
        const modelData = {
            "Claude": {
                        "Claude Opus 4.1": "claude-opus-4-1-20250805",
                        "Claude Opus 4": "claude-opus-4-20250514",
                        "Claude Sonnet 4": "claude-sonnet-4-20250514",
                        "Claude Sonnet 3.7": "claude-3-7-sonnet-20250219",
                        "Claude Sonnet 3.5 (New)": "claude-3-5-sonnet-20241022",
                        "Claude Haiku 3.5": "claude-3-5-haiku-20241022"
            },
            "Gemini": {
                        "Gemini 2.5 Pro": "gemini-2.5-pro",
                        "Gemini 2.5 Flash": "gemini-2.5-flash",
                        "Gemini 2.5 Flash-Lite": "gemini-2.5-flash-lite",
                        "Gemini 2.5 Pro Preview 03-25": "gemini-2.5-pro-preview-03-25",
                        "Gemini 2.5 Pro Preview 05-06": "gemini-2.5-pro-preview-05-06",
                        "Gemini 2.5 Pro Preview": "gemini-2.5-pro-preview-06-05"
            },
            "OpenAI": {
                        "Gpt 4.1 Nano": "gpt-4.1-nano",
                        "Gpt 4.1 Nano 2025 04 14": "gpt-4.1-nano-2025-04-14",
                        "Gpt 4.1 Mini": "gpt-4.1-mini",
                        "Gpt 4.1 Mini 2025 04 14": "gpt-4.1-mini-2025-04-14",
                        "Gpt 4.1": "gpt-4.1",
                        "Gpt 4.1 2025 04 14": "gpt-4.1-2025-04-14"
            }
};

        // OpenRouter model data organized by provider

        let verboseLogging = false;

        function log(message) {
            console.log('üîç DEBUG:', message);
            if (verboseLogging) {
                const debugInfo = document.getElementById('debugInfo1');
                debugInfo.innerHTML += message + '<br>';
            }
        }

        function loadModelsForPoet(poetNumber, provider) {
            log(`Called loadModelsForPoet(${poetNumber}, "${provider}")`);
            
            const modelSelect = document.getElementById(`testModel${poetNumber}`);
            const resultDiv = document.getElementById(`testResult${poetNumber}`);
            
            log(`Model select element: ${modelSelect ? 'Found' : 'NOT FOUND'}`);
            log(`Result div element: ${resultDiv ? 'Found' : 'NOT FOUND'}`);
            
            if (!provider) {
                log('No provider selected - disabling dropdown');
                modelSelect.disabled = true;
                modelSelect.innerHTML = '<option value="">First select a provider...</option>';
                resultDiv.innerHTML = '';
                return;
            }

            log(`Looking for models for provider: "${provider}"`);
            log(`modelData object exists: ${typeof modelData !== 'undefined'}`);
            log(`modelData keys: ${typeof modelData !== 'undefined' ? Object.keys(modelData).join(', ') : 'undefined'}`);

            const models = modelData[provider];
            log(`Models for ${provider}: ${models ? 'Found' : 'NOT FOUND'}`);
            
            if (models) {
                log(`Number of models found: ${Object.keys(models).length}`);
                log(`First few models: ${Object.keys(models).slice(0, 3).join(', ')}`);
            }
            
            if (!models) {
                log(`No models found for provider: ${provider}`);
                modelSelect.innerHTML = '<option value="">No models available</option>';
                modelSelect.disabled = true;
                resultDiv.innerHTML = '<span class="error">‚ùå No models found for ' + provider + '</span>';
                return;
            }
            
            log('Populating dropdown with models...');
            modelSelect.innerHTML = '<option value="">Select model...</option>';
            
            let modelCount = 0;
            Object.entries(models).forEach(([displayName, modelId]) => {
                log(`Adding model: ${displayName} ‚Üí ${modelId}`);
                const option = document.createElement('option');
                option.value = modelId;
                option.textContent = displayName;
                modelSelect.appendChild(option);
                modelCount++;
            });
            
            modelSelect.disabled = false;
            log(`Successfully added ${modelCount} models to dropdown`);
            resultDiv.innerHTML = `<span class="success">‚úÖ Loaded ${modelCount} models for ${provider}</span>`;
        }

        function manualTest(provider, modelSelectId, resultId, debugId) {
            document.getElementById(debugId).innerHTML = '';
            log(`Manual test: Loading models for ${provider}`);
            
            // Get the poet number from the select ID
            const poetNumber = modelSelectId.replace('testModel', '');
            loadModelsForPoet(poetNumber, provider);
        }

        function inspectModelData() {
            const resultDiv = document.getElementById('inspectionResult');
            let html = '<strong>Model Data Inspection:</strong><br>';
            
            if (typeof modelData === 'undefined') {
                html += '‚ùå modelData is undefined!<br>';
            } else {
                html += `‚úÖ modelData exists<br>`;
                html += `üìä Providers: ${Object.keys(modelData).join(', ')}<br>`;
                
                Object.entries(modelData).forEach(([provider, models]) => {
                    html += `<br><strong>${provider}:</strong> ${Object.keys(models).length} models<br>`;
                    Object.entries(models).slice(0, 3).forEach(([name, id]) => {
                        html += `&nbsp;&nbsp;‚Ä¢ ${name} ‚Üí ${id}<br>`;
                    });
                    if (Object.keys(models).length > 3) {
                        html += `&nbsp;&nbsp;... and ${Object.keys(models).length - 3} more<br>`;
                    }
                });
            }
            
            resultDiv.innerHTML = html;
        }

        function testFunctionExists() {
            const resultDiv = document.getElementById('inspectionResult');
            let html = '<strong>Function Existence Test:</strong><br>';
            
            html += `loadModelsForPoet: ${typeof loadModelsForPoet === 'function' ? '‚úÖ Exists' : '‚ùå Missing'}<br>`;
            html += `Object.entries: ${typeof Object.entries === 'function' ? '‚úÖ Exists' : '‚ùå Missing'}<br>`;
            html += `document.getElementById: ${typeof document.getElementById === 'function' ? '‚úÖ Exists' : '‚ùå Missing'}<br>`;
            
            resultDiv.innerHTML += html;
        }

        function enableVerboseLogging() {
            verboseLogging = true;
            log('Verbose logging enabled');
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM loaded, setting up event listeners');
            
            document.getElementById('testProvider1').addEventListener('change', function() {
                log(`Provider changed to: "${this.value}"`);
                loadModelsForPoet('1', this.value);
            });
            
            log('Event listeners set up successfully');
            
            // Auto-run inspection
            setTimeout(() => {
                inspectModelData();
                testFunctionExists();
            }, 500);
        });
    </script>
</body>
</html>
